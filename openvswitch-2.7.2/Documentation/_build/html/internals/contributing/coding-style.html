<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Open vSwitch Coding Style &mdash; Open vSwitch 2.6.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Open vSwitch 2.6.0 documentation" href="../../index.html" />
    <link rel="up" title="Contributing to Open vSwitch" href="index.html" />
    <link rel="next" title="Open vSwitch Windows Datapath Coding Style" href="coding-style-windows.html" />
    <link rel="prev" title="Submitting Patches" href="submitting-patches.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="coding-style-windows.html" title="Open vSwitch Windows Datapath Coding Style"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="submitting-patches.html" title="Submitting Patches"
             accesskey="P">previous</a> |</li>
        <li><a href="../../contents.html">Open vSwitch 2.6.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Open vSwitch Internals</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Contributing to Open vSwitch</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="open-vswitch-coding-style">
<h1>Open vSwitch Coding Style<a class="headerlink" href="#open-vswitch-coding-style" title="Permalink to this headline">¶</a></h1>
<p>This file describes the coding style used in most C files in the Open vSwitch
distribution. However, Linux kernel code datapath directory follows the Linux
kernel&#8217;s established coding conventions. For the Windows kernel datapath code,
use the coding style described in <a class="reference internal" href="coding-style-windows.html"><em>Open vSwitch Windows Datapath Coding Style</em></a>.</p>
<p>The following GNU indent options approximate this style.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="o">-</span><span class="n">npro</span> <span class="o">-</span><span class="n">bad</span> <span class="o">-</span><span class="n">bap</span> <span class="o">-</span><span class="n">bbb</span> <span class="o">-</span><span class="n">br</span> <span class="o">-</span><span class="n">blf</span> <span class="o">-</span><span class="n">brs</span> <span class="o">-</span><span class="n">cdw</span> <span class="o">-</span><span class="n">ce</span> <span class="o">-</span><span class="n">fca</span> <span class="o">-</span><span class="n">cli0</span> <span class="o">-</span><span class="n">npcs</span> <span class="o">-</span><span class="n">i4</span> <span class="o">-</span><span class="n">l79</span> \
<span class="o">-</span><span class="n">lc79</span> <span class="o">-</span><span class="n">nbfda</span> <span class="o">-</span><span class="n">nut</span> <span class="o">-</span><span class="n">saf</span> <span class="o">-</span><span class="n">sai</span> <span class="o">-</span><span class="n">saw</span> <span class="o">-</span><span class="n">sbi4</span> <span class="o">-</span><span class="n">sc</span> <span class="o">-</span><span class="n">sob</span> <span class="o">-</span><span class="n">st</span> <span class="o">-</span><span class="n">ncdb</span> <span class="o">-</span><span class="n">pi4</span> <span class="o">-</span><span class="n">cs</span> <span class="o">-</span><span class="n">bs</span> \
<span class="o">-</span><span class="n">di1</span> <span class="o">-</span><span class="n">lp</span> <span class="o">-</span><span class="n">il0</span> <span class="o">-</span><span class="n">hnl</span>
</pre></div>
</div>
<div class="section" id="basics">
<span id="id1"></span><h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Limit lines to 79 characters.</li>
<li>Use form feeds (control+L) to divide long source files into logical pieces. A
form feed should appear as the only character on a line.</li>
<li>Do not use tabs for indentation.</li>
<li>Avoid trailing spaces on lines.</li>
</ul>
</div>
<div class="section" id="naming">
<span id="id2"></span><h2>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Use names that explain the purpose of a function or object.</li>
<li>Use underscores to separate words in an identifier: <tt class="docutils literal"><span class="pre">multi_word_name</span></tt>.</li>
<li>Use lowercase for most names. Use uppercase for macros, macro parameters,
and members of enumerations.</li>
<li>Give arrays names that are plural.</li>
<li>Pick a unique name prefix (ending with an underscore) for each
module, and apply that prefix to all of that module&#8217;s externally
visible names. Names of macro parameters, struct and union members,
and parameters in function prototypes are not considered externally
visible for this purpose.</li>
<li>Do not use names that begin with <tt class="docutils literal"><span class="pre">_</span></tt>. If you need a name for &#8220;internal use
only&#8221;, use <tt class="docutils literal"><span class="pre">__</span></tt> as a suffix instead of a prefix.</li>
<li>Avoid negative names: <tt class="docutils literal"><span class="pre">found</span></tt> is a better name than <tt class="docutils literal"><span class="pre">not_found</span></tt>.</li>
<li>In names, a <tt class="docutils literal"><span class="pre">size</span></tt> is a count of bytes, a <tt class="docutils literal"><span class="pre">length</span></tt> is a count of
characters.  A buffer has size, but a string has length. The length of a
string does not include the null terminator, but the size of the buffer that
contains the string does.</li>
</ul>
</div>
<div class="section" id="comments">
<span id="id3"></span><h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<p>Comments should be written as full sentences that start with a capital letter
and end with a period. Put two spaces between sentences.</p>
<p>Write block comments as shown below. You may put the <tt class="docutils literal"><span class="pre">/*</span></tt> and <tt class="docutils literal"><span class="pre">*/</span></tt> on the
same line as comment text if you prefer.</p>
<div class="highlight-python"><div class="highlight"><pre>/*
 * We redirect stderr to /dev/null because we often want to remove all
 * traffic control configuration on a port so its in a known state.  If
 * this done when there is no such configuration, tc complains, so we just
 * always ignore it.
 */
</pre></div>
</div>
<p>Each function and each variable declared outside a function, and each struct,
union, and typedef declaration should be preceded by a comment. See <a class="reference internal" href="#functions">functions</a>
below for function comment guidelines.</p>
<p>Each struct and union member should each have an inline comment that explains
its meaning. structs and unions with many members should be additionally
divided into logical groups of members by block comments, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>/* An event that will wake the following call to poll_block(). */
struct poll_waiter {
    /* Set when the waiter is created. */
    struct ovs_list node;       /* Element in global waiters list. */
    int fd;                     /* File descriptor. */
    short int events;           /* Events to wait for (POLLIN, POLLOUT). */
    poll_fd_func *function;     /* Callback function, if any, or null. */
    void *aux;                  /* Argument to callback function. */
    struct backtrace *backtrace; /* Event that created waiter, or null. */

    /* Set only when poll_block() is called. */
    struct pollfd *pollfd;      /* Pointer to element of the pollfds array
                                   (null if added from a callback). */
};
</pre></div>
</div>
<p>Use <tt class="docutils literal"><span class="pre">XXX</span></tt> or <tt class="docutils literal"><span class="pre">FIXME</span></tt> comments to mark code that needs work.</p>
<p>Don&#8217;t use <tt class="docutils literal"><span class="pre">//</span></tt> comments.</p>
<p>Don&#8217;t comment out or #if 0 out code. Just remove it. The code that was there
will still be in version control history.</p>
</div>
<div class="section" id="functions">
<span id="id4"></span><h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Put the return type, function name, and the braces that surround the function&#8217;s
code on separate lines, all starting in column 0.</p>
<p>Before each function definition, write a comment that describes the function&#8217;s
purpose, including each parameter, the return value, and side effects.
References to argument names should be given in single-quotes, e.g. &#8216;arg&#8217;. The
comment should not include the function name, nor need it follow any formal
structure. The comment does not need to describe how a function does its work,
unless this information is needed to use the function correctly (this is often
better done with comments <em>inside</em> the function).</p>
<p>Simple static functions do not need a comment.</p>
<p>Within a file, non-static functions should come first, in the order that they
are declared in the header file, followed by static functions.  Static
functions should be in one or more separate pages (separated by form feed
characters) in logical groups. A commonly useful way to divide groups is by
&#8220;level&#8221;, with high-level functions first, followed by groups of progressively
lower-level functions. This makes it easy for the program&#8217;s reader to see the
top-down structure by reading from top to bottom.</p>
<p>All function declarations and definitions should include a prototype.  Empty
parentheses, e.g. <tt class="docutils literal"><span class="pre">int</span> <span class="pre">foo();</span></tt>, do not include a prototype (they state that
the function&#8217;s parameters are unknown); write <tt class="docutils literal"><span class="pre">void</span></tt> in parentheses instead,
e.g. <tt class="docutils literal"><span class="pre">int</span> <span class="pre">foo(void);</span></tt>.</p>
<p>Prototypes for static functions should either all go at the top of the file,
separated into groups by blank lines, or they should appear at the top of each
page of functions. Don&#8217;t comment individual prototypes, but a comment on each
group of prototypes is often appropriate.</p>
<p>In the absence of good reasons for another order, the following parameter order
is preferred. One notable exception is that data parameters and their
corresponding size parameters should be paired.</p>
<ol class="arabic simple">
<li>The primary object being manipulated, if any (equivalent to the &#8220;this&#8221;
pointer in C++).</li>
<li>Input-only parameters.</li>
<li>Input/output parameters.</li>
<li>Output-only parameters.</li>
<li>Status parameter.</li>
</ol>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>```
/* Stores the features supported by &#39;netdev&#39; into each of &#39;*current&#39;,
 * &#39;*advertised&#39;, &#39;*supported&#39;, and &#39;*peer&#39; that are non-null.  Each value
 * is a bitmap of &quot;enum ofp_port_features&quot; bits, in host byte order.
 * Returns 0 if successful, otherwise a positive errno value.  On failure,
 * all of the passed-in values are set to 0. */
int
netdev_get_features(struct netdev *netdev,
                    uint32_t *current, uint32_t *advertised,
                    uint32_t *supported, uint32_t *peer)
{
    ...
}
```
</pre></div>
</div>
<p>Functions that destroy an instance of a dynamically-allocated type should
accept and ignore a null pointer argument. Code that calls such a function
(including the C standard library function <tt class="docutils literal"><span class="pre">free()</span></tt>) should omit a
null-pointer check. We find that this usually makes code easier to read.</p>
<p>Functions in <tt class="docutils literal"><span class="pre">.c</span></tt> files should not normally be marked <tt class="docutils literal"><span class="pre">inline</span></tt>, because it
does not usually help code generation and it does suppress compilers warnings
about unused functions. (Functions defined in .h usually should be marked
inline.)</p>
</div>
<div class="section" id="function-prototypes">
<span id="id5"></span><h2>Function Prototypes<a class="headerlink" href="#function-prototypes" title="Permalink to this headline">¶</a></h2>
<p>Put the return type and function name on the same line in a function prototype:</p>
<div class="highlight-python"><div class="highlight"><pre>static const struct option_class *get_option_class(int code);
</pre></div>
</div>
<p>Omit parameter names from function prototypes when the names do not give useful
information, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>int netdev_get_mtu(const struct netdev *, int *mtup);
</pre></div>
</div>
</div>
<div class="section" id="statements">
<h2>Statements<a class="headerlink" href="#statements" title="Permalink to this headline">¶</a></h2>
<p>Indent each level of code with 4 spaces. Use BSD-style brace placement:</p>
<div class="highlight-python"><div class="highlight"><pre>if (a()) {
    b();
    d();
}
</pre></div>
</div>
<p>Put a space between <tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">while</span></tt>, <tt class="docutils literal"><span class="pre">for</span></tt>, etc. and the expressions that
follow them.</p>
<p>Enclose single statements in braces:</p>
<div class="highlight-python"><div class="highlight"><pre>if (a &gt; b) {
    return a;
} else {
    return b;
}
</pre></div>
</div>
<p>Use comments and blank lines to divide long functions into logical groups of
statements.</p>
<p>Avoid assignments inside <tt class="docutils literal"><span class="pre">if</span></tt> and <tt class="docutils literal"><span class="pre">while</span></tt> conditions.</p>
<p>Do not put gratuitous parentheses around the expression in a return statement,
that is, write <tt class="docutils literal"><span class="pre">return</span> <span class="pre">0;</span></tt> and not <tt class="docutils literal"><span class="pre">return(0);</span></tt></p>
<p>Write only one statement per line.</p>
<p>Indent <tt class="docutils literal"><span class="pre">switch</span></tt> statements like this:</p>
<div class="highlight-python"><div class="highlight"><pre>switch (conn-&gt;state) {
case S_RECV:
    error = run_connection_input(conn);
    break;

case S_PROCESS:
    error = 0;
    break;

case S_SEND:
    error = run_connection_output(conn);
    break;

default:
    OVS_NOT_REACHED();
}
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">switch</span></tt> statements with very short, uniform cases may use an abbreviated
style:</p>
<div class="highlight-python"><div class="highlight"><pre>switch (code) {
case 200: return &quot;OK&quot;;
case 201: return &quot;Created&quot;;
case 202: return &quot;Accepted&quot;;
case 204: return &quot;No Content&quot;;
default: return &quot;Unknown&quot;;
}
</pre></div>
</div>
<p>Use <tt class="docutils literal"><span class="pre">for</span> <span class="pre">(;;)</span></tt> to write an infinite loop.</p>
<p>In an if/else construct where one branch is the &#8220;normal&#8221; or &#8220;common&#8221; case and
the other branch is the &#8220;uncommon&#8221; or &#8220;error&#8221; case, put the common case after
the &#8220;if&#8221;, not the &#8220;else&#8221;. This is a form of documentation. It also places the
most important code in sequential order without forcing the reader to visually
skip past less important details. (Some compilers also assume that the &#8220;if&#8221;
branch is the more common case, so this can be a real form of optimization as
well.)</p>
</div>
<div class="section" id="return-values">
<h2>Return Values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h2>
<p>For functions that return a success or failure indication, prefer one of the
following return value conventions:</p>
<ul class="simple">
<li>An <tt class="docutils literal"><span class="pre">int</span></tt> where 0 indicates success and a positive errno value indicates a
reason for failure.</li>
<li>A <tt class="docutils literal"><span class="pre">bool</span></tt> where true indicates success and false indicates failure.</li>
</ul>
</div>
<div class="section" id="macros">
<h2>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h2>
<p>Don&#8217;t define an object-like macro if an enum can be used instead.</p>
<p>Don&#8217;t define a function-like macro if a &#8220;static inline&#8221; function can be used
instead.</p>
<p>If a macro&#8217;s definition contains multiple statements, enclose them with <tt class="docutils literal"><span class="pre">do</span> <span class="pre">{</span>
<span class="pre">...</span> <span class="pre">}</span> <span class="pre">while</span> <span class="pre">(0)</span></tt> to allow them to work properly in all syntactic
circumstances.</p>
<p>Do use macros to eliminate the need to update different parts of a single file
in parallel, e.g. a list of enums and an array that gives the name of each
enum. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>/* Logging importance levels. */
#define VLOG_LEVELS                             \
    VLOG_LEVEL(EMER, LOG_ALERT)                 \
    VLOG_LEVEL(ERR, LOG_ERR)                    \
    VLOG_LEVEL(WARN, LOG_WARNING)               \
    VLOG_LEVEL(INFO, LOG_NOTICE)                \
    VLOG_LEVEL(DBG, LOG_DEBUG)
enum vlog_level {
#define VLOG_LEVEL(NAME, SYSLOG_LEVEL) VLL_##NAME,
    VLOG_LEVELS
#undef VLOG_LEVEL
    VLL_N_LEVELS
};

/* Name for each logging level. */
static const char *level_names[VLL_N_LEVELS] = {
#define VLOG_LEVEL(NAME, SYSLOG_LEVEL) #NAME,
    VLOG_LEVELS
#undef VLOG_LEVEL
};
</pre></div>
</div>
</div>
<div class="section" id="thread-safety-annotations">
<h2>Thread Safety Annotations<a class="headerlink" href="#thread-safety-annotations" title="Permalink to this headline">¶</a></h2>
<p>Use the macros in <tt class="docutils literal"><span class="pre">lib/compiler.h</span></tt> to annotate locking requirements. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre>static struct ovs_mutex mutex = OVS_MUTEX_INITIALIZER;
static struct ovs_rwlock rwlock = OVS_RWLOCK_INITIALIZER;

void function_require_plain_mutex(void) OVS_REQUIRES(mutex);
void function_require_rwlock(void) OVS_REQ_RDLOCK(rwlock);
</pre></div>
</div>
<p>Pass lock objects, not their addresses, to the annotation macros. (Thus we have
<tt class="docutils literal"><span class="pre">OVS_REQUIRES(mutex)</span></tt> above, not <tt class="docutils literal"><span class="pre">OVS_REQUIRES(&amp;mutex)</span></tt>.)</p>
</div>
<div class="section" id="source-files">
<span id="id6"></span><h2>Source Files<a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h2>
<p>Each source file should state its license in a comment at the very top,
followed by a comment explaining the purpose of the code that is in that file.
The comment should explain how the code in the file relates to code in other
files. The goal is to allow a programmer to quickly figure out where a given
module fits into the larger system.</p>
<p>The first non-comment line in a .c source file should be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#include &lt;config.h&gt;</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">#include</span></tt> directives should appear in the following order:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">#include</span> <span class="pre">&lt;config.h&gt;</span></tt></li>
<li>The module&#8217;s own headers, if any. Including this before any other header
(besides ) ensures that the module&#8217;s header file is self-contained (see
<a class="reference internal" href="#header-files">header files</a> below).</li>
<li>Standard C library headers and other system headers, preferably in
alphabetical order. (Occasionally one encounters a set of system headers
that must be included in a particular order, in which case that order must
take precedence.)</li>
<li>Open vSwitch headers, in alphabetical order. Use <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt>, not <tt class="docutils literal"><span class="pre">&lt;&gt;</span></tt>, to
specify Open vSwitch header names.</li>
</ol>
</div>
<div class="section" id="header-files">
<span id="id7"></span><h2>Header Files<a class="headerlink" href="#header-files" title="Permalink to this headline">¶</a></h2>
<p>Each header file should start with its license, as described under <a class="reference internal" href="#source-files">source
files</a> above, followed by a &#8220;header guard&#8221; to make the header file idempotent,
like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#ifndef NETDEV_H</span>
<span class="c">#define NETDEV_H 1</span>

<span class="o">...</span>

<span class="c">#endif /* netdev.h */</span>
</pre></div>
</div>
<p>Header files should be self-contained; that is, they should <tt class="docutils literal"><span class="pre">#include</span></tt> whatever
additional headers are required, without requiring the client to <tt class="docutils literal"><span class="pre">#include</span></tt>
them for it.</p>
<p>Don&#8217;t define the members of a struct or union in a header file, unless client
code is actually intended to access them directly or if the definition is
otherwise actually needed (e.g. inline functions defined in the header need
them).</p>
<p>Similarly, don&#8217;t <tt class="docutils literal"><span class="pre">#include</span></tt> a header file just for the declaration of a
struct or union tag (e.g. just for <tt class="docutils literal"><span class="pre">struct</span> <span class="pre">;</span></tt>). Just declare the tag
yourself.  This reduces the number of header file dependencies.</p>
</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>Use typedefs sparingly. Code is clearer if the actual type is visible at the
point of declaration. Do not, in general, declare a typedef for a struct,
union, or enum. Do not declare a typedef for a pointer type, because this can
be very confusing to the reader.</p>
<p>A function type is a good use for a typedef because it can clarify code.  The
type should be a function type, not a pointer-to-function type. That way, the
typedef name can be used to declare function prototypes. (It cannot be used for
function definitions, because that is explicitly prohibited by C89 and C99.)</p>
<p>You may assume that <tt class="docutils literal"><span class="pre">char</span></tt> is exactly 8 bits and that <tt class="docutils literal"><span class="pre">int</span></tt> and <tt class="docutils literal"><span class="pre">long</span></tt>
are at least 32 bits.</p>
<p>Don&#8217;t assume that <tt class="docutils literal"><span class="pre">long</span></tt> is big enough to hold a pointer. If you need to cast
a pointer to an integer, use <tt class="docutils literal"><span class="pre">intptr_t</span></tt> or <tt class="docutils literal"><span class="pre">uintptr_t</span></tt> from .</p>
<p>Use the <tt class="docutils literal"><span class="pre">int_t</span></tt> and <tt class="docutils literal"><span class="pre">uint_t</span></tt> types from for exact-width integer types. Use
the <tt class="docutils literal"><span class="pre">PRId</span></tt>, <tt class="docutils literal"><span class="pre">PRIu</span></tt>, and <tt class="docutils literal"><span class="pre">PRIx</span></tt> macros from for formatting them with
<tt class="docutils literal"><span class="pre">printf()</span></tt> and related functions.</p>
<p>For compatibility with antique <tt class="docutils literal"><span class="pre">printf()</span></tt> implementations:</p>
<ul class="simple">
<li>Instead of <tt class="docutils literal"><span class="pre">&quot;%zu&quot;</span></tt>, use <tt class="docutils literal"><span class="pre">&quot;%&quot;PRIuSIZE</span></tt>.</li>
<li>Instead of <tt class="docutils literal"><span class="pre">&quot;%td&quot;</span></tt>, use <tt class="docutils literal"><span class="pre">&quot;%&quot;PRIdPTR</span></tt>.</li>
<li>Instead of <tt class="docutils literal"><span class="pre">&quot;%ju&quot;</span></tt>, use <tt class="docutils literal"><span class="pre">&quot;%&quot;PRIuMAX</span></tt>.</li>
</ul>
<p>Other variants exist for different radixes. For example, use <tt class="docutils literal"><span class="pre">&quot;%&quot;PRIxSIZE</span></tt>
instead of <tt class="docutils literal"><span class="pre">&quot;%zx&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;%x&quot;</span></tt> instead of <tt class="docutils literal"><span class="pre">&quot;%hhx&quot;</span></tt>.</p>
<p>Also, instead of <tt class="docutils literal"><span class="pre">&quot;%hhd&quot;</span></tt>, use <tt class="docutils literal"><span class="pre">&quot;%d&quot;</span></tt>. Be cautious substituting <tt class="docutils literal"><span class="pre">&quot;%u&quot;</span></tt>,
<tt class="docutils literal"><span class="pre">&quot;%x&quot;</span></tt>, and <tt class="docutils literal"><span class="pre">&quot;%o&quot;</span></tt> for the corresponding versions with <tt class="docutils literal"><span class="pre">&quot;hh&quot;</span></tt>: cast the
argument to unsigned char if necessary, because <tt class="docutils literal"><span class="pre">printf(&quot;%hhu&quot;,</span> <span class="pre">-1)</span></tt> prints
255 but <tt class="docutils literal"><span class="pre">printf(&quot;%u&quot;,</span> <span class="pre">-1)</span></tt> prints 4294967295.</p>
<p>Use bit-fields sparingly. Do not use bit-fields for layout of network
protocol fields or in other circumstances where the exact format is
important.</p>
<p>Declare bit-fields to be signed or unsigned integer types or _Bool (aka
bool). Do <em>not</em> declare bit-fields of type <tt class="docutils literal"><span class="pre">int</span></tt>: C99 allows these to be
either signed or unsigned according to the compiler&#8217;s whim. (A 1-bit bit-field
of type <tt class="docutils literal"><span class="pre">int</span></tt> may have a range of -1...0!)</p>
<p>Try to order structure members such that they pack well on a system with 2-byte
<tt class="docutils literal"><span class="pre">short</span></tt>, 4-byte <tt class="docutils literal"><span class="pre">int</span></tt>, and 4- or 8-byte <tt class="docutils literal"><span class="pre">long</span></tt> and pointer types.  Prefer
clear organization over size optimization unless you are convinced there is a
size or speed benefit.</p>
<p>Pointer declarators bind to the variable name, not the type name. Write
<tt class="docutils literal"><span class="pre">int</span> <span class="pre">*x</span></tt>, not <tt class="docutils literal"><span class="pre">int*</span> <span class="pre">x</span></tt> and definitely not <tt class="docutils literal"><span class="pre">int</span> <span class="pre">*</span> <span class="pre">x</span></tt>.</p>
</div>
<div class="section" id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline">¶</a></h2>
<p>Put one space on each side of infix binary and ternary operators:</p>
<div class="highlight-python"><div class="highlight"><pre>* / %
+ -
&lt;&lt; &gt;&gt;
&lt; &lt;= &gt; &gt;=
== !=
&amp;
^
|
&amp;&amp;
||
?:
= += -= *= /= %= &amp;= ^= |= &lt;&lt;= &gt;&gt;=
</pre></div>
</div>
<p>Avoid comma operators.</p>
<p>Do not put any white space around postfix, prefix, or grouping operators:</p>
<div class="highlight-python"><div class="highlight"><pre>() [] -&gt; .
! ~ ++ -- + - * &amp;
</pre></div>
</div>
<p>Exception 1: Put a space after (but not before) the &#8220;sizeof&#8221; keyword.</p>
<p>Exception 2: Put a space between the () used in a cast and the expression whose
type is cast: <tt class="docutils literal"><span class="pre">(void</span> <span class="pre">\*)</span> <span class="pre">0</span></tt>.</p>
<p>Break long lines before the ternary operators ? and :, rather than after
them, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>return (out_port != VIGP_CONTROL_PATH
        ? alpheus_output_port(dp, skb, out_port)
        : alpheus_output_control(dp, skb, fwd_save_skb(skb),
                                 VIGR_ACTION));
</pre></div>
</div>
<p>Do not parenthesize the operands of <tt class="docutils literal"><span class="pre">&amp;&amp;</span></tt> and <tt class="docutils literal"><span class="pre">||</span></tt> unless operator
precedence makes it necessary, or unless the operands are themselves
expressions that use <tt class="docutils literal"><span class="pre">&amp;&amp;</span></tt> and <tt class="docutils literal"><span class="pre">||</span></tt>. Thus:</p>
<div class="highlight-python"><div class="highlight"><pre>if (!isdigit((unsigned char)s[0])
    || !isdigit((unsigned char)s[1])
    || !isdigit((unsigned char)s[2])) {
    printf(&quot;string %s does not start with 3-digit code\n&quot;, s);
}
</pre></div>
</div>
<p>but</p>
<div class="highlight-python"><div class="highlight"><pre>if (rule &amp;&amp; (!best || rule-&gt;priority &gt; best-&gt;priority)) {
    best = rule;
}
</pre></div>
</div>
<p>Do parenthesize a subexpression that must be split across more than one line,
e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>*idxp = ((l1_idx &lt;&lt; PORT_ARRAY_L1_SHIFT)
         | (l2_idx &lt;&lt; PORT_ARRAY_L2_SHIFT)
         | (l3_idx &lt;&lt; PORT_ARRAY_L3_SHIFT));
</pre></div>
</div>
<p>Try to avoid casts. Don&#8217;t cast the return value of malloc().</p>
<p>The &#8220;sizeof&#8221; operator is unique among C operators in that it accepts two very
different kinds of operands: an expression or a type. In general, prefer to
specify an expression, e.g. <tt class="docutils literal"><span class="pre">int</span> <span class="pre">*x</span> <span class="pre">=</span> <span class="pre">xmalloc(sizeof</span> <span class="pre">*\</span> <span class="pre">x);</span></tt>. When the
operand of sizeof is an expression, there is no need to parenthesize that
operand, and please don&#8217;t.</p>
<p>Use the <tt class="docutils literal"><span class="pre">ARRAY_SIZE</span></tt> macro from <tt class="docutils literal"><span class="pre">lib/util.h</span></tt> to calculate the number of
elements in an array.</p>
<p>When using a relational operator like <tt class="docutils literal"><span class="pre">&lt;</span></tt> or <tt class="docutils literal"><span class="pre">==</span></tt>, put an expression or
variable argument on the left and a constant argument on the right, e.g.
<tt class="docutils literal"><span class="pre">x</span> <span class="pre">==</span> <span class="pre">0</span></tt>, <em>not</em> <tt class="docutils literal"><span class="pre">0</span> <span class="pre">==</span> <span class="pre">x</span></tt>.</p>
</div>
<div class="section" id="blank-lines">
<h2>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this headline">¶</a></h2>
<p>Put one blank line between top-level definitions of functions and global
variables.</p>
</div>
<div class="section" id="c-dialect">
<h2>C DIALECT<a class="headerlink" href="#c-dialect" title="Permalink to this headline">¶</a></h2>
<p>Most C99 features are OK because they are widely implemented:</p>
<ul>
<li><p class="first">Flexible array members (e.g. <tt class="docutils literal"><span class="pre">struct</span> <span class="pre">{</span> <span class="pre">int</span> <span class="pre">foo[];</span> <span class="pre">}</span></tt>).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">static</span> <span class="pre">inline</span></tt> functions (but no other forms of <tt class="docutils literal"><span class="pre">inline</span></tt>, for which GCC
and C99 have differing interpretations).</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">long</span> <span class="pre">long</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">bool</span></tt> and <tt class="docutils literal"><span class="pre">&lt;stdbool.h&gt;</span></tt>, but don&#8217;t assume that bool or _Bool can only
take on the values 0 or 1, because this behavior can&#8217;t be simulated on C89
compilers.</p>
<p>Also, don&#8217;t assume that a conversion to <tt class="docutils literal"><span class="pre">bool</span></tt> or <tt class="docutils literal"><span class="pre">_Bool</span></tt> follows C99
semantics, i.e. use <tt class="docutils literal"><span class="pre">(bool)(some_value</span> <span class="pre">!=</span> <span class="pre">0)</span></tt> rather than
<tt class="docutils literal"><span class="pre">(bool)some_value</span></tt>. The latter might produce unexpected results on non-C99
environments. For example, if bool is implemented as a typedef of char and
<tt class="docutils literal"><span class="pre">some_value</span> <span class="pre">=</span> <span class="pre">0x10000000</span></tt>.</p>
</li>
<li><p class="first">Designated initializers (e.g. <tt class="docutils literal"><span class="pre">struct</span> <span class="pre">foo</span> <span class="pre">foo</span> <span class="pre">=</span> <span class="pre">{.a</span> <span class="pre">=</span> <span class="pre">1};</span></tt> and <tt class="docutils literal"><span class="pre">int</span>
<span class="pre">a[]</span> <span class="pre">=</span> <span class="pre">{[2]</span> <span class="pre">=</span> <span class="pre">5};</span></tt>).</p>
</li>
<li><p class="first">Mixing of declarations and code within a block. Please use this
judiciously; keep declarations nicely grouped together in the
beginning of a block if possible.</p>
</li>
<li><p class="first">Use of declarations in iteration statements (e.g. <tt class="docutils literal"><span class="pre">for</span> <span class="pre">(int</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span>
<span class="pre">&lt;</span> <span class="pre">10;</span> <span class="pre">i++)</span></tt>).</p>
</li>
<li><p class="first">Use of a trailing comma in an enum declaration (e.g. <tt class="docutils literal"><span class="pre">enum</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">1,</span>
<span class="pre">};</span></tt>).</p>
</li>
</ul>
<p>As a matter of style, avoid <tt class="docutils literal"><span class="pre">//</span></tt> comments.</p>
<p>Avoid using GCC or Clang extensions unless you also add a fallback for other
compilers. You can, however, use C99 features or GCC extensions also supported
by Clang in code that compiles only on GNU/Linux (such as
<tt class="docutils literal"><span class="pre">lib/netdev-linux.c</span></tt>), because GCC is the system compiler there.</p>
</div>
<div class="section" id="python">
<h2>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<p>When introducing new Python code, try to follow Python&#8217;s <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP 8</a> style. Consider running the
<tt class="docutils literal"><span class="pre">pep8</span></tt> or <tt class="docutils literal"><span class="pre">flake8</span></tt> tool against your code to find issues.</p>
</div>
<div class="section" id="libraries">
<h2>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h2>
<p>When introducing a new library, follow
<a class="reference internal" href="libopenvswitch-abi.html"><em>Open vSwitch Library ABI guide</em></a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../contents.html">
              <img class="logo" src="../../_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Open vSwitch Coding Style</a><ul>
<li><a class="reference internal" href="#basics">Basics</a></li>
<li><a class="reference internal" href="#naming">Naming</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#function-prototypes">Function Prototypes</a></li>
<li><a class="reference internal" href="#statements">Statements</a></li>
<li><a class="reference internal" href="#return-values">Return Values</a></li>
<li><a class="reference internal" href="#macros">Macros</a></li>
<li><a class="reference internal" href="#thread-safety-annotations">Thread Safety Annotations</a></li>
<li><a class="reference internal" href="#source-files">Source Files</a></li>
<li><a class="reference internal" href="#header-files">Header Files</a></li>
<li><a class="reference internal" href="#types">Types</a></li>
<li><a class="reference internal" href="#expressions">Expressions</a></li>
<li><a class="reference internal" href="#blank-lines">Blank Lines</a></li>
<li><a class="reference internal" href="#c-dialect">C DIALECT</a></li>
<li><a class="reference internal" href="#python">Python</a></li>
<li><a class="reference internal" href="#libraries">Libraries</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="submitting-patches.html"
                        title="previous chapter">Submitting Patches</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="coding-style-windows.html"
                        title="next chapter">Open vSwitch Windows Datapath Coding Style</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/internals/contributing/coding-style.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="coding-style-windows.html" title="Open vSwitch Windows Datapath Coding Style"
             >next</a> |</li>
        <li class="right" >
          <a href="submitting-patches.html" title="Submitting Patches"
             >previous</a> |</li>
        <li><a href="../../contents.html">Open vSwitch 2.6.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Open vSwitch Internals</a> &raquo;</li>
          <li><a href="index.html" >Contributing to Open vSwitch</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, The Open vSwitch Development Community.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>