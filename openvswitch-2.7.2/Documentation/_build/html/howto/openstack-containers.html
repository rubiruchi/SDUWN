<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Integration of Containers with OVN and OpenStack &mdash; Open vSwitch 2.6.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Open vSwitch 2.6.0 documentation" href="../index.html" />
    <link rel="up" title="How-to Guides" href="index.html" />
    <link rel="next" title="Reference Guide" href="../ref/index.html" />
    <link rel="prev" title="Open Virtual Networking With Docker" href="docker.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../ref/index.html" title="Reference Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="docker.html" title="Open Virtual Networking With Docker"
             accesskey="P">previous</a> |</li>
        <li><a href="../contents.html">Open vSwitch 2.6.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">How-to Guides</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="integration-of-containers-with-ovn-and-openstack">
<h1>Integration of Containers with OVN and OpenStack<a class="headerlink" href="#integration-of-containers-with-ovn-and-openstack" title="Permalink to this headline">Â¶</a></h1>
<p>Isolation between containers is weaker than isolation between VMs, so some
environments deploy containers for different tenants in separate VMs as an
additional security measure.  This document describes creation of containers
inside VMs and how they can be made part of the logical networks securely.  The
created logical network can include VMs, containers and physical machines as
endpoints.  To better understand the proposed integration of containers with
OVN and OpenStack, this document describes the end to end workflow with an
example.</p>
<ul class="simple">
<li>A OpenStack tenant creates a VM (say VM-A) with a single network interface
that belongs to a management logical network.  The VM is meant to host
containers.  OpenStack Nova chooses the hypervisor on which VM-A is created.</li>
<li>A Neutron port may have been created in advance and passed in to Nova with
the request to create a new VM.  If not, Nova will issue a request to Neutron
to create a new port.  The ID of the logical port from Neutron will also be
used as the vif-id for the virtual network interface (VIF) of VM-A.</li>
<li>When VM-A is created on a hypervisor, its VIF gets added to the Open vSwitch
integration bridge.  This creates a row in the Interface table of the
<tt class="docutils literal"><span class="pre">Open_vSwitch</span></tt> database.  As explained in the <a class="reference internal" href="../topics/integration.html"><em>integration guide</em></a>, the vif-id associated with the VM network interface
gets added in the <tt class="docutils literal"><span class="pre">external_ids:iface-id</span></tt> column of the newly created row
in the Interface table.</li>
<li>Since VM-A belongs to a logical network, it gets an IP address.  This IP
address is used to spawn containers (either manually or through container
orchestration systems) inside that VM and to monitor the health of the
created containers.</li>
<li>The vif-id associated with the VM&#8217;s network interface can be obtained by
making a call to Neutron using tenant credentials.</li>
<li>This flow assumes a component called a &#8220;container network plugin&#8221;.  If you
take Docker as an example for containers, you could envision the plugin to be
either a wrapper around Docker or a feature of Docker itself that understands
how to perform part of this workflow to get a container connected to a
logical network managed by Neutron.  The rest of the flow refers to this
logical component that does not yet exist as the &#8220;container network plugin&#8221;.</li>
<li>All the calls to Neutron will need tenant credentials.  These calls can
either be made from inside the tenant VM as part of a container network
plugin or from outside the tenant VM (if the tenant is not comfortable using
temporary Keystone tokens from inside the tenant VMs).  For simplicity, this
document explains the work flow using the former method.</li>
<li>The container hosting VM will need Open vSwitch installed in it.  The only
work for Open vSwitch inside the VM is to tag network traffic coming from
containers.</li>
<li>When a container needs to be created inside the VM with a container network
interface that is expected to be attached to a particular logical switch, the
network plugin in that VM chooses any unused VLAN (This VLAN tag only needs
to be unique inside that VM.  This limits the number of container interfaces
to 4096 inside a single VM).  This VLAN tag is stripped out in the hypervisor
by OVN and is only useful as a context (or metadata) for OVN.</li>
<li>The container network plugin then makes a call to Neutron to create a logical
port.  In addition to all the inputs that a call to create a port in Neutron
that are currently needed, it sends the vif-id and the VLAN tag as inputs.</li>
<li>Neutron in turn will verify that the vif-id belongs to the tenant in question
and then uses the OVN specific plugin to create a new row in the
Logical_Switch_Port table of the OVN Northbound Database.  Neutron responds
back with an IP address and MAC address for that network interface.  So
Neutron becomes the IPAM system and provides unique IP and MAC addresses
across VMs and containers in the same logical network.</li>
<li>The Neutron API call above to create a logical port for the container could
add a relatively significant amount of time to container creation.  However,
an optimization is possible here.  Logical ports could be created in advance
and reused by the container system doing container orchestration.  Additional
Neutron API calls would only be needed if the port needs to be attached to a
different logical network.</li>
<li>When a container is eventually deleted, the network plugin in that VM may
make a call to Neutron to delete that port.  Neutron in turn will delete the
entry in the <tt class="docutils literal"><span class="pre">Logical_Switch_Port</span></tt> table of the OVN Northbound Database.</li>
</ul>
<p>As an example, consider Docker containers.  Since Docker currently does not
have a network plugin feature, this example uses a hypothetical wrapper around
Docker to make calls to Neutron.</p>
<ul>
<li><p class="first">Create a Logical switch:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ovn-docker --cred=cca86bd13a564ac2a63ddf14bf45d37f create network LS1
</pre></div>
</div>
<p>The above command will make a call to Neutron with the credentials to create
a logical switch.  The above is optional if the logical switch has already
been created from outside the VM.</p>
</li>
<li><p class="first">List networks available to the tenant:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ovn-docker --cred=cca86bd13a564ac2a63ddf14bf45d37f list networks
</pre></div>
</div>
</li>
<li><p class="first">Create a container and attach a interface to the previously created switch as
a logical port:</p>
<div class="highlight-python"><div class="highlight"><pre>$ ovn-docker --cred=cca86bd13a564ac2a63ddf14bf45d37f --vif-id=$VIF_ID \
    --network=LS1 run -d --net=none ubuntu:14.04 /bin/sh -c \
    &quot;while true; do echo hello world; sleep 1; done&quot;
</pre></div>
</div>
<p>The above command will make a call to Neutron with all the inputs it
currently needs to create a logical port.  In addition, it passes the $VIF_ID
and a unused VLAN.  Neutron will add that information in OVN and return back
a MAC address and IP address for that interface.  ovn-docker will then create
a veth pair, insert one end inside the container as &#8216;eth0&#8217; and the other end
as a port of a local OVS bridge as an access port of the chosen VLAN.</p>
</li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../contents.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="docker.html"
                        title="previous chapter">Open Virtual Networking With Docker</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../ref/index.html"
                        title="next chapter">Reference Guide</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/howto/openstack-containers.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../ref/index.html" title="Reference Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="docker.html" title="Open Virtual Networking With Docker"
             >previous</a> |</li>
        <li><a href="../contents.html">Open vSwitch 2.6.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >How-to Guides</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, The Open vSwitch Development Community.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>